# Linux_Summary

## 常用操作和命令

### 命令行

#### 目录操作：

1. `pwd`：查看当前工作目录的绝对路径
2. `cd <路径>`：切换工作目录

   - 绝对路径：从根目录开始（如 `cd /home/user`）
   - 相对路径： 
     - `.` ：当前目录（如 `cd ./docs`）
     - `..` ：父级目录（如 `cd ../parent`）
     - `~` ：当前用户的 home 目录（如 `cd ~` 或直接 `cd`）
     - `-` ：上一个工作目录（如 `cd -` 切换回之前目录）
3. `ls <路径>`：列出目录中的文件和子目录

   - `-a`：显示所有文件（包括隐藏文件，以 `.` 开头的文件）
   - `-l`：长格式显示（权限、所有者、大小、修改时间等）
   - `-h`：与 `-l` 配合，以人类可读格式显示文件大小（如 K、M）
   - `-t`：按修改时间排序（最新的在前）
   - `-R`：递归列出子目录内容
   - `-r`：反向排序（配合 `-t` 可实现 oldest first）

   - 示例：
     - `ls -lha` 显示当前目录所有文件的详细信息（含隐藏文件）
4. `mkdir <目录名>`：创建目录
   - `-p`：递归创建多级目录（如 `mkdir -p a/b/c`）
   - 示例：
     - `mkdir docs images` 同时创建两个目录

#### 文件操作：

1. `touch <文件名>`：创建空文件或更新文件时间戳
   - 示例：
     - `touch test.txt` 创建空文本文件；若文件已存在，更新其访问和修改时间
2. `file <文件名/路径>`：识别文件的实际类型
   - 示例：
     - `file script.sh` 可能输出 "Bourne-Again shell script"
3. `cat <文件名>`：查看文件内容（适合小文件）
   - `-n`：显示行号
   - 示例：
     - `cat -n text.txt` 显示带行号的文件内容
4. `less <文件名>`：分页查看大文件内容（支持交互操作）

   - `q`：退出
   - `Page Up/Page Down` 或 箭头键：上下滚动
   - `g`：跳至文件开头
   - `G`：跳至文件结尾
   - `/关键词`：向下搜索关键词（按 `n` 找下一个，`N` 找上一个）
   - `h`：查看帮助

#### 文件目录管理：

1. `cp <源> <目标>`：复制文件或目录
  - `-r`：递归复制目录（含子目录和文件）
  - `-i`：覆盖前提示确认
  - `-v`：显示复制过程

  - 示例：
    - 复制文件：`cp file.txt ~/backup/`
    - 复制目录：`cp -r docs/ ~/archive/`
2. `mv <源> <目标>`：移动或重命名文件 / 目录

   - 示例：
     - 重命名：`mv oldname.txt newname.txt`
     - 移动：`mv document.pdf ~/Downloads/`
     - 移动并改名：`mv photo.jpg ~/Pictures/vacation.jpg`
3. `rm <文件/目录>`：删除文件或目录
   - `-r`：递归删除目录（含所有内容）
     - **`rmdir` 仅能删除空目录，而 `rm -r` 可删除非空目录**
   - `-f`：强制删除（不提示）
   - `-i`：删除前提示确认

   - 示例：
     - 删除文件：`rm file.txt`
     - 删除空目录：`rmdir emptydir` 或 `rm -r emptydir`
     - 强制删除非空目录：`rm -rf dirwithfiles`（谨慎使用！）

#### 其他操作：

1. `echo <文本内容>`：打印文本内容
   - 示例：
     - `echo "Hello World"` 输出 Hello World
     - 可结合重定向：`echo "test" > file.txt` 将内容写入文件
2. `find <路径> <条件>`：查找文件或目录
   - `-name "文件名"`：按名称查找（支持通配符 `*`）
   - `-type f`：查找文件；`-type d`：查找目录
   - `-size +10M`：查找大于 10M 的文件
   - `-mtime -7`：查找近 7 天修改过的文件

   - 示例：
     - `find /home -name "*.txt"` 查找 home 下所有 txt 文件
     - `find ./ -type d -name "docs"` 在当前目录找名为 docs 的目录
3. `clear`：清除终端屏幕显示（快捷键 `Ctrl+L` 效果相同）
4. `exit`：退出当前终端会话（快捷键 `Ctrl+D` 效果相同）

### 用户管理

#### 用户和组

在任何传统的操作系统中，都有用户和组。

- 当运行一个进程时，**进程将以其所有者的用户身份运行**：无论是 Jane 还是 Bob。
- **文件访问和所有权依赖于权限机制（用户和组的UID机制**）：你不会希望 Jane 看到 Bob 的文档，反之亦然。

系统使用用户 ID（UID）来管理用户。用户名是关联用户身份的友好方式，但系统通过其 UID 来识别用户。

系统还使用组来管理权限。组只是一组用户，其权限由该组设置；它们由系统通过其组 ID（GID）识别。

- **UID（用户 ID）**：系统识别用户的唯一标识（root 的 UID 固定为 0）
- **GID（组 ID）**：系统识别组的唯一标识，组是用户的集合，便于批量管理权限
- **用户名 / 组名**：为方便人类记忆的标识，系统实际通过 UID/GID 操作

#### sudo命令：提升命令权限

1. 用户的分类：

   - root（超级用户）：拥有系统最高权限，可访问所有文件、操控所有进程，谨慎使用

   - 系统用户：非人类用户，用于运行系统进程（如守护进程），如 `daemon`、`mysql` 等用户（通常 UID 小于 1000）。
   - 普通用户：人类用户（通常 UID 大于等于 1000），权限受限制，需通过 `sudo` 临时提升权限

2.  用户的切换：

   - `sudo <命令>`：默认以超级用户执行指定命令
     - `-u <user>`：指定以某个用户执行（默认是 root）

3. 用户能否使用 `sudo` 命令提升权限的配置文件：`/etc/sudoers`

   - 修改`/etc/sudoers`：必须使用`sudo visudo`

   - 典型配置：`username ALL=(ALL:ALL) ALL`

     意思：用户 `username` 可以在任意主机上，以任意用户或组的身份执行任意命令

#### 其他配置文件

1. **`/etc/passwd`**（用户信息）：包含所有用户（含系统用户）用户列表及其详细信息

   - 通过 `cat /etc/passwd` 查看
   - 每行格式（冒号分隔）：`用户名:x:UID:GID:GECOS注释:主目录:默认shell`
     - `x` 表示密码存储在 `/etc/shadow` 中。

2. **`/etc/shadow`**（用户密码与认证）：存储用户认证信息

   - 需 root 权限查看：`sudo cat /etc/shadow`

   - 每行格式：`用户名:加密密码:上次改密天数:最小有效期:最大有效期:警告期:不活动期:过期日期:保留`
     - 存储加密密码，是用户认证的核心文件。
   - 用户认证不仅仅依赖于 `/etc/shadow` 文件；还有其他机制，例如 PAM，它们取代了认证

3. **`/etc/group`**（组信息）：允许不同的组拥有不同的权限

   - 通过 `cat /etc/group` 查看。
   - 每行格式：`组名:*:GID:成员用户列表`
     - `*` 表示组密码通常不设置，权限管理依赖 `sudo`。

### 权限管理

#### 文件权限

Linux 文件权限由 **10 个字符**（ 4 个部分）表示，格式为：`文件类型 | 所有者权限 | 所属组权限 | 其他用户权限`，例如 `drwxr-xr-x`。

- 第一部分：**文件类型**，由1个字符表示，常用：`d` 目录，`-`普通文件，`l`：符号链接（软链接，类似快捷方式）
- 后三部分：**权限位**，共 9 个字符，每 3 位一组，按顺序分为 **所有者（u）、所属组（g）、其他用户（o）** 
  - `r`（read）：可读权限
    - 对文件：可查看内容（如 `cat`、`less`）
    - 对目录：可列出目录内文件（如 `ls`）
  - `w`（write）：可写权限
    - 对文件：可修改内容（如编辑、删除）
    - 对目录：可创建 / 删除 / 重命名目录内文件（需同时有 `x` 权限）
  - `x`（execute）：可执行权限
    - 对文件：可运行程序 / 脚本（如 `./script.sh`）
    - 对目录：可进入该目录（如 `cd`），是使用目录内文件的基础权限
  - `-`：空

#### chmod命令：修改文件权限

两种使用方法：

1. **符号法修改权限**：`chmod [用户集][±][权限] 文件名`
   - **用户集**：
     - `u`：文件所有者（user）
     - `g`：所属组（group）
     - `o`：其他用户（others）
     - `a`：所有用户（all，等同于 u+g+o）
   - **操作符**：
     - `+`：添加权限
     - `-`：移除权限
     - `=`：设置权限（覆盖原有权限）
   - **权限**：
     - `r`：读权限
     - `w`：写权限
     - `x`：执行权限
2. **数字法修改权限**：`chmod [三位数字] 文件名`
   - **数字对应权限**：
     - `4`：读权限（r）
     - `2`：写权限（w）
     - `1`：执行权限（x）
   - 每组权限为三个数字的和，三位数字分别对应：**所有者权限 + 所属组权限 + 其他用户权限**
     - 常见权限组合：
       - `644`：文件默认权限（所有者 rw，组和其他 r）
       - `755`：目录默认权限（所有者 rwx，组和其他 rx）
       - `700`：私密文件（仅所有者有全部权限）

#### chown/chgrp命令：修改文件所属

1.  修改文件所有者：`sudo chown <新所有者> <文件>`

2. 修改文件所属组：`sudo chgrp <新组> <文件>`

3. 同时修改所有者和所属组：`sudo chown <新所有者>:<新组> <文件>`

#### Umask默认权限掩码

- **作用**：控制新创建文件 / 目录的默认权限（通过 “移除权限” 实现）。
- **原理**：默认权限 = 基础权限 - umask 掩码（文件基础权限为 `666`，目录为 `777`）。
  - 默认 umask 为 `022`：
    - 文件默认权限：`666 - 022 = 644`（所有者 rw，组和其他 r）。
    - 目录默认权限：`777 - 022 = 755`（所有者 rwx，组和其他 rx）。
  - 执行 `umask 021`：
    - 文件默认权限：`666 - 021 = 645`（所有者 rw，组 r，其他 rx）。
- **持久化**：需修改启动文件 (`.profile`)，否则仅当前会话生效

#### 用户/组的UID机制

1. **SetUID（SUID，用户特殊权限）**

   - 作用：允许用户以**文件所有者的身份**运行程序（而非自身身份）

   - 权限标识：所有者执行位 `x` 变为 `s`，若无执行权限则显示 `S`
     - **符号法：`sudo chmod u+s 文件名`**
     - **数字法：在权限前加 `4`（如 `4755`，表示所有者 rwx+s，组和其他 rx）**

2.  **SetGID（SGID，组特殊权限）**

- 作用：允许用户以**文件所属组的身份**运行程序；对目录而言，新创建的文件 / 目录会继承该目录的所属组
- 权限标识：组执行位 `x` 变为 `s`，若无执行权限则显示 `S`
  - **符号法：`sudo chmod g+s 文件名/目录`**
  - **数字法：在权限前加 `2`（如 `2555`，表示所有者 rwx，组 rx+s，其他 rx）**

3. **进程如何实现权限控制：UID机制，每个进程关联 3 种 UID，用于权限控制**

   - **真实 UID（RUID）**：启动进程的用户 ID（跟踪实际用户）

   - **有效 UID（EUID）**：进程实际运行时的权限 ID（用于文件访问控制，如 SUID 会使 EUID 变为文件所有者 UID）

   - **保存 UID（SUID）**：允许进程在 EUID 和 RUID 之间切换

#### 粘滞位

- 作用：**对共享目录生效**（如：`/tmp`，`/home/...`）;
  - 只有**文件的所有者、目录的所有者或 root 用户**，才能删除或移动该目录下的文件
- 权限标识：其他用户执行位 `x` 变为 `t`，若无执行权限则显示 `T`
- 修改方式：
  - **符号法：`sudo chmod +t 目录名`。**
  - **数字法：在权限前加 `1`（如 `1755`，表示所有者 rwx，组 rx，其他 rx+t）**

### 进程管理

#### 进程

**进程**是运行中程序的实例：

- 每个进程都有唯一的**进程ID（PID）**
- 进程按创建顺序分配PID
- 内核负责管理所有进程的生命周期
- 进程拥有独立的内存空间、文件描述符、CPU时间片

#### 查看进程详情

1. **`ps`：进程快照**

   ```bash
   # 基本用法
   ps              # 显示当前终端的进程
   ps aux          # 显示所有进程详细信息
   ps aux | grep nginx # 查找包含nginx的PID
   ps l            # 长格式，包含:PPID信息
   ps -ef          # System V风格的完整格式
   
   ```

   **输出字段解释：**

   - PID：进程ID

   - PPID：父进程ID

   - USER：进程所有者

   - TTY：执行命令的终端

     > **终端的分类：**
     >
     > - **物理终端**，如**串口终端**：通过串行端口连接的真实终端设备
     > - **虚拟终端**：它们在物理控制台设备驱动程序之上模拟的多个**控制台程序** 
     > -  **伪终端**：指伪终端master和伪终端slave这一对字符设备，即**SSH链接或者终端的图形化界面**

     - `tty1`：虚拟终端1；通过Ctrl+Alt+F1进入的控制台
     - `pts/0`：伪终端0；图形界面的终端窗口或SSH连接
     - `ttyS0`：串口终端0；通过串口连接的终端
     - `?`：无控制终端；守护进程、内核线程

   - `S`：进程状态

     - R：Running/Runnable;正在运行或等待
     - S：可中断睡眠;等待事件，可被信号唤醒\
     - D：不可中断睡眠;等待关键I/O，无法被信号中断
     - **Z：僵尸状态;**已死亡但未被回收编程错误
     - T：已停止;被信号暂停
     - X：已死亡;正在死亡过程中
       - **附加修饰符：**
         - `<` : 高优先级进程
         - `N` : 低优先级进程
         - `+` : 前台进程组
         - `s` : 会话领导者
         - `l` : 多线程进程

   - TIME：CPU累计时间

   - COMMAND：完整命令行

2. **`top`：实时监控**

   - 交互式操作：
     - `P`  - 按CPU使用率排序
     - `M`  - 按内存使用率排序  
     - `T`  - 按CPU时间排序 
     - `k`  - 杀死进程（输入PID） 
     - `r`  - 调整进程优先级 
     - `q`  - 退出
     - `h`  - 帮助

3. **`/proc`：在 Linux 中，一切皆文件，甚至进程也是如此；进程信息存储在`/proc` 文件系统**

   ```bash
   /proc/
   ├── 1/                    # PID为1的进程（init）
   ├── 1234/                 # PID为1234的进程
   ├── self/                 # 指向当前进程的符号链接
   ├── cpuinfo               # CPU信息
   ├── meminfo               # 内存信息
   ├── loadavg               # 系统负载
   └── version               # 内核版本
   ```

#### 进程生命周期及其优先级管理

1. **进程生命周期管理：kill命令，发送信号**

   ```bash
   # 基本语法
   kill [选项] [信号] PID...
   
   # 常用示例
   kill 1234           # 请求优雅终止
   kill -9 1234        # 发送SIGKILL(9)，强制终止
   kill -KILL 1234     # 同上，使用信号名
   
   kill -STOP 1234     # 暂停进程
   kill -CONT 1234     # 恢复进程
   kill -HUP 1234      # 发送挂断信号（常用于重载配置）
   ```

2. **进程优先级控制：Linux使用nice值控制 “用户空间的进程优先级”**

   > **PRI 或者PR** ： **内核空间决定**的进程优先级，默认20

   - **范围：-20（最高优先级）到 +19（最低优先级）**

   - **默认值：0**

   - 数值越小，优先级越高
   - 数值越大，进程越"nice"，让出更多CPU时间

   ```bash
   # nice命令：启动时设置优先级
   # nice [选项] [优先级值] 运行的命令
   nice -n 5 apt upgrade              # 以nice=5运行系统升级
   nice -n 15 backup_script.sh        # 以nice=15运行备份脚本
   
   # renice命令：调整运行中进程的优先级
   # renice [优先级值] [选项] [目标]
   renice 15 -p 1234         # 将PID 1234的nice值设为15
   renice 5 -u username      # 将username用户的所有进程nice设为5
   ```

   

